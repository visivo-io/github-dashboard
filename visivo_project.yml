name: Github Metrics

defaults:
  target_name: github-snowflake

targets:
  - name: github-snowflake
    type: snowflake
    database: {{ env_var('GITHUB_SNOWFLAKE_DATABASE') }}
    account: {{ env_var('GITHUB_SNOWFLAKE_ACCOUNT') }}
    db_schema: {{ env_var('GITHUB_SNOWFLAKE_DB_SCHEMA') }}
    username: {{ env_var('GITHUB_SNOWFLAKE_USERNAME') }}
    warehouse: {{ env_var('GITHUB_SNOWFLAKE_WAREHOUSE') }}
    password: {{ env_var('GITHUB_SNOWFLAKE_PASSWORD') }}

models:
  - name: github
    sql: "SELECT _id, action FROM GITHUB"

traces:
  - name: Pull Request Reviews by Person
    model: ref(github)
    columns:
      x_data: action
    props:
      type: bar
      x: column(x_data)
      y: query( _id )

dashboards:
  - name: Github Metrics
    rows:
      - height: medium
        items:
          - width: 9
            chart:
              name: Pull Requests
              traces:
                - ref(Pull Request Reviews by Person)
              layout:
                title: "Pull Request Reviews by Person"
